---
title: "Data analysis. Klsh-14"
output: html_document
---

Занятие 1
---------


Табличка с данными. Как описать её?

* График. Гистограмма. Пара вопросов по гистограмме.
Почему гистограмма лучше круговой диаграммы? Не так удобно сравнивать
* "зависимость"
* описательная статистика
среднее, минимум, максимум, медиана

пример с зарплатой, что лучше, медиана или среднее?

Формула вершины параболы. 

Для тех, кто не знает, выводим так: свободный член не влияет, а дальше --- середина между корнями.

Пример с ростом и весом. Три человека ищем простую зависимость.

Метод наименьших квадратов. Минимизируем сумму квадратов ошибок,

$$ \min \hat{e}_1^2+\hat{e}_2^2+\hat{e}_3^2 $$


Коммент:

надо было взять один коэффициент в примере с ростом и весом, а я взял два :)


Занятие 2
---------

R как простой калькулятор
```{r}
x <- 5
y <- 9
x + y
```

Пробелы рядом со знаками можно не ставить, но так симпатявее :)
Длинные названия R умеет писать сам, если уже знает его и в середине нажать "таб".


```{r}
moe_lyubimoe_chislo <- 9
```

Векторы и пропущенные наблюдения (NA)
```{r}
r <- c(2,3,5.6,NA,7,0)
r + 3
```

Давайте поделим на ноль! :)

```{r}
1/r
```


Помимо консольного (диалогового) режима работы есть еще возможность написания скрипта. File - New File - R-script. Если встать на строчку в любое место и нажать Ctrl+Enter, то она выполнится. Если выделить несколько строк и нажать  Ctrl+Enter, то они выполнятся друг за дружкой.


Создадим табличку из трёх векторов
```{r}
name <- c("Маша","Саша")
height <- c(160,180)
choco <- c(2,3)
t <- data.frame(name,height,choco)
t
```

Добавим ещё один столбец
```{r}
t$profit <- t$choco * 50
t
```

Удалим столбец
```{r}
t$name <- NULL
t
```

Подменим одно наблюдение
```{r}
t$height[2] <- 183
t
```

И в конце занятия глянем время :)
```{r}
Sys.time()
```


Занятие 3
---------

В R для учебных целей и задач тестирования новых алгоритмов есть куча встроенных наборов данных. Например, есть набор данных по скорости и длине тормозного пути автомобилей в начале 20 века. 

Посмотрим на начало и хвост набора данных:

```{r}
head(cars)
tail(cars)
```

Заглянем в описание данных:
```{r}
help("cars")
```

Ага! Переведём мили и футы в километры и поместим новые переменные снова в таблицу `cars`:
```{r}
cars$kph <- 1.609 * cars$speed
cars$m <- 0.3048 * cars$dist
```

Снова глянем на начало таблички:
```{r}
head(cars)
```

Посчитаем среднее, медиану, минимум и максимум:
```{r}
mean(cars$kph)
max(cars$kph)
min(cars$kph)
median(cars$kph)
```

Можно посмотреть описательные статистики одной командой:
```{r}
summary(cars$kph)
```

Помимо знакомых нам медианы, минимума и максимума тут есть загадочные `1st Qu` и `3rd Qu` --- это первый и третий квартиль. Что это за пушистые зверюги? Представим, что мы упорядочили наши наблюдения от большего к меньшему. Поделим упорядоченные наблдения на четыре равные части. По краям будут миним и максимум. Посередине --- медианы. Первый квартиль отделяет четверть самых маленьких наблюдений. Третий квартиль отделяет четверть самых больших наблюдений. Между этими квартилями лежит ровно половина всех наблюдений.

Как в R пишутся комментарии?
```{r}
# Hi, folks!
```

R является открытым софтом, его все могут дописывать. И есть большое количество дополнительных пакетов, расширяющих R. Воспользуемся пакетом, который реализует грамматику графиков, т.е. их стандартизацию и послойное построение. 

```{r}
require("ggplot2")
```

Если компьютер ругается, что пакет не найден, то пакет можно установить через Tools - Install packages.


Посмотрим на график наших наблюдений
```{r}
qplot(data=cars,kph,m)
```


Понять хороший график перед тобой, или плохой, очень легко. Если график понятен без дополнительных пояснений, если его можно вырезать, показать молча постороннему человеку, и он поймёт график, то график идеален. Наш график плохой :) Не хватает подписей осей и заголовка:  

```{r, warning=FALSE}
qplot(data=cars,kph,m,
  xlab="Скорость машины (км/ч)",
  ylab="Длина тормозного пути (м)",
  main="Данные по машинам 1920х годов")
```


А еще построим гистограмму скорости :)
```{r, warning=FALSE}
qplot(data=cars,kph,binwidth=2.5,
      xlab="Скорость машины (км/ч)",
      ylab="Количество машин",
      main="Данные 1920х")
```

Параметр `binwidth` определяет ширину столбиков гистограммы.

* Построй гистограмму для длины пути
* Поиграйся с параметром ширины столбика
* Экспериментируй! Тебе интересно, а можно ли в R сделать как-нибудь вот эдак? Пробуй! :)

Занятие 4
---------

Занятие 5
---------

Как выбрать наилучшую модель?

* Использовать здравый смысл

* Хорошо когда ошибки прогнозов малы

Что нам подсказывает здравый смысл? Длина тормозного пути растёт с ростом скорости машины. Если машина стоит, то длина тормозного пути равна нулю :)

Посмотрим на суммы квадратов ошибок наших четырёх моделей, $\hat{e}_1^2+\hat{e}_2^2+\ldots+\hat{e}_{50}^2$:


```{r}
#deviance(m1)
#deviance(m2)
#deviance(m3)
#deviance(m4)
```

Хотя четвёртая модель имеет наименьшую сумму квадратов ошибок прогнозов, не стоит слепо верить этому критерию. 
Давайте нанесём прогнозную линию на график с исходными наблюдениями:





Ссылки:

* [R в действии]()

* [RLMS](www.hse.ru/rlms)

* [Заметки по R]()
