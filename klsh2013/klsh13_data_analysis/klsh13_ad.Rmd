Анализ данных, КЛШ-2013
=======================

## Встреча 1, 17 июля

Распространенные типы данных в общественных науках:
* Временный ряды
* Кросс-секционнные данные
* Панельные данных

Софт, используемый для анализа данных: 

Excel, Gnumeric, SPSS, Stata, Eviews, SAS, gretl, R, python

Бесплатные: Gnumeric, gretl, R, python

Типы переменных:
* Количественные
* Качественные неупорядоченные
* Качественные упорядоченные

Типичный анализ данных:
* Загрузить данные в пакет
* Посмотреть на данные
* Почистить
* Посмотреть на данные
* Оценить модели
* Посмотреть на результаты оценивания

Три формы записи параболы:
* $y(x)=ax^2+bx+c$, около $x=0$ парабола похожа на прямую $y(x)=bx+c$
* $y(x)=a(x-x_1)(x-x_2)$
* $y(x)=a(x-x_*)^2+y_*$

Нахождение минимума или максимума: $x_*=\frac{x_1+x_2}{2}=-\frac{b}{2a}$


## Встреча 2, 18 июля, ... человек

Создаём АДскую папку `c:/ad/`

**Заповедь:** Никогда не используйте кириллицу в названиях файлов и папок!

Пояснение: R --- сам язык программирования, R-studio --- удобная красивая оболочка для работы в R 

Два режима работы в R:
* Консоль, диалоговый режим --- вводим команду, она сразу исполняется
* Написание программы (скрипта) --- набираем кучу команд. Выделяем строки, которые хотим запустить, нажимаем `Run`. Под windows можно нажать Ctrl+Enter.

Используем R как простой калькулятор:
```{r}
5+6
```

Чуть посложнее:
```{r}
sin(pi/6)
```

Работаем с пропущенными наблюдениями, NA (Not Available):
```{r}
5+NA
```

R отличает заглавные и строчные буквы:
```{r}
a <- 5
A <- 7
a+A
```

Рекомендация: пиши все переменные маленькими буквами, несколько слов можно разделить точкой:
```{r}
moe.lubimoe.chislo <- 42
moe.lubimoe.chislo/2
```


Работаем с векторами:
```{r}
x <- c(6,3,2.5)
2*x
```

Переходим в режим написания скрипта (File --- New --- R-script):
```{r}
height <- c(182,168,156,157,162,172,182,170,160,
            168,185,177,178,184,175,153,160,175,
            177,171)

age <- c(32,16,17,15,17,17,16,NA,17,15,17,
         17,17,17,15,16,16,17,17,18)

weight <- c(80,51,48,48,47,NA,79,NA,50,48,70,
            74,58,68,60,40,NA,55,70,57)

```

Считаем среднее "в лоб":
```{r}
mean(age)
mean(height)
```

Смотрим справку по функции
```{r}
help(mean)
```

Считаем среднее игнорируя пропущенные значения:
```{r}
mean(height,na.rm=TRUE)
mean(weight,na.rm=TRUE)
```

R --- это открытый язык программирования, любой желающий может дописать новый функции и сделать их общедоступными. Мы загрузим пакет `erer` в котором, например, есть функции для рисовки красивых графиков:
```{r, message=FALSE}
library(erer)
```

Нарисуем первый график:
```{r, warning=FALSE}
qplot(age,height)
```

Это неправильный график!

**Заповедь:** На графике всегда должны быть подписаны оси с единицами измерения!

Рисуем правильный график:
```{r, warning=FALSE,message=FALSE}
qplot(age,height,xlab="Возраст (лет)",ylab="Рост (см)")
```

Теперь правильную гистограмму:
```{r, warning=FALSE,message=FALSE}
qplot(weight,xlab="Вес (кг)",ylab="Количество наблюдений")
```

Можно поменять ширину столбиков гистограммы. Сделаем широкие столбики по 10 кг:
```{r, warning=FALSE,message=FALSE}
qplot(weight, binwidth=10,
      xlab="Вес (кг)",ylab="Количество наблюдений")
```

## Встреча 3, 19 июля, ... человек

### Создаём длинные векторы.

Вектор из одинаковых чисел, 10 раз повторено число 42:
```{r}
x <- rep(42,10)
x
```

Вектор из последовательности 1, 7, 3, повторенной 5 раз:
```{r}
y <- rep(c(1,7,3),5)
y
```

Вектор последовательных чисел от 5 до 20:
```{r}
z <- 5:20
z
```

Случайный вектор из 50 чисел в диапазоне от -3 до 7, возможны дробные значения:
```{r}
w <- runif(50,min=-3,max=7)
w
```

Посмотрим на среднее, минимум и максимум в векторе w:
```{r}
mean(w)
min(w)
max(w)
```

Случайная выборка с повторением и без повторения:

* Без повторения --- каждый элемент не может быть взят больше одного раза
```{r}
v1 <- sample(1:6,5)
v1
```

* С повторением --- один элемент может быть выбран несколько раз
```{r}
v2 <- sample(1:6,50,replace=TRUE)
v2
```

Строить случайную выборку можно не только из чисел:
```{r}
v3 <- sample(c("Аня","Боря"),50,rep=TRUE)
v3
```

Легко узнать, сколько раз повторяется каждый элемент
```{r}
table(v3)
```

### Нахождение нужного куска вектора

Печатаем 42-й элемент вектора `v2`:
```{r}
v2[42]
```

Печатаем 17-ый, 38-ой и 42-ой элементы вектора `v2`:
```{r}
v2[c(17,38,42)]
```

Печатаем элементы с 5 по 15-ый у вектора `v2`:
```{r}
v2[5:15]
```

Находим элементы больше 3-х в векторе `v2`:
```{r}
vv <- v2[v2>3]
vv
```

Под какими номерами шли элементы большие, чем три?
```{r}
which(v2>3)
```

### Объединение данных в табличку:

Создаём три вектора:
```{r}
h <- runif(20,min=160,max=180)
w <- sample(50:70,20,rep=TRUE)
s <- sample(c("мальчик","девочка"),20,rep=TRUE)
```

Объединяем в одну табличку данных:
```{r}
zz <- data.frame(h,w,s)
zz
```

Поскольку табличка --- двумерный объект, нужно указывать две координаты: сначала --- строку, затем --- столбец:
```{r}
zz[4,2]
```

Четвертая строка целиком:
```{r}
zz[4,]
```

Первый столбец целиком:
```{r}
zz[,1]
```

Строки с 4-ой по 10-ую, 2-ой и 3-ий столбцы:
```{r}
zz[4:10,2:3]
```

Можно называть столбцы по именам:
```{r}
zz$w
```

Сохраняем табличку с данными в нашу АДскую папку `c:/ad/ad3.Rdata`
```{r, eval=FALSE}
save(zz,file="c:/ad/ad3.Rdata")
```

## Встреча 4, 20 июля, ... человек

Существует много форматов хранения данных, условно их можно разделить на две части:
* `.csv` --- данные записаны в виде простого текста. Достоинства: читабелен человеком, можно открыть в любой программе, скорее всего этот формат можно будет прочитать через 100 лет. 
* `.xlsx`, `.Rdata`, `.dat` ... --- формат, "заточенный" под конкретную программу анализа данных. Достоинства: меньший размер файла, высокая скорость обработки
Мораль: пока тебе не приходится по минуте ждать пока откроется файл, нужно использовать `.csv`.

Читаем наш набор данных:
```{r, eval=FALSE}
load(file="c:/ad/ad3.Rdata")
zz
```

Сохраняем его в `.csv`:
```{r, eval=FALSE}
write.csv(zz,file="c:/ad/ad3.csv")
```

Когда загружена большая табличка с данными, имеет смысл посмотреть начало, конец и структуру таблички:
```{r}
head(zz)
tail(zz)
str(zz)
```

Определение. Медиана --- число, меньше которого имеется 50% наблюдений

Медиана является частным случаем понятия "квантиль".

Определение (на примере). 42-ух процентный квантиль --- число, меньше которого имеется 42% наблюдений.

Из этого следует, что медиана --- это квантиль порядка 50%.


Определение. 1-ый квартиль --- это квантиль порядка 25%, 2-ый квартиль --- это квантиль порядка 50% или медиана, 3-ый квартиль --- это квантиль порядка 75%


Краткий отчет по каждой переменной содержит медиану, квартили, среднее, минимум и максимум:
```{r}
summary(zz)
```


Задача. На предприятии пять сотрудников с зарплатами 20, 20, 30, 50, 500 рублей. Найди среднюю зарплату, моду зарплаты, медиану. На какую зарплату имеет смысл рассчитывать сотруднику, прошедшему половину карьерного пути? Какую зарплату получает большинство сотрудников? Какую зарплату скорее всего напишут в объявлении о приеме на работу: среднюю, медианную, моду?


Задача. 

```{r, echo=FALSE}
temp <- jitter(rpois(10000,lambda=3))
qplot(temp,binwidth=0.5)
```

По графику расположите по возрастанию моду, медиану и среднее.

Задача. Дано пять чисел, не обязательно в порядке возрастания, не обязательно целых: 2, 3, $x$, 6, 7. При каком значении $x$ медиана и среднее совпадут?


## Встреча 5, 22 июля, ... человек

### Построим график функции...
```{r}
x <- seq(from=0,to=10,by=0.05)
y <- cos(x)
qplot(x,y,geom="line",main="y=cos(x)")
```




